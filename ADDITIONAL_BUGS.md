# 🐛 追加で発見したバグ

## 🔴 重大なバグ

### 1. **配列の範囲外アクセス**
**場所**: `app/adventure/battle/page.tsx`

**問題**:
- `checkAutoRevive(memberIndex)`で`party[memberIndex]`がundefinedの可能性がある
- `useSkill(memberIndex)`で`party[memberIndex]`がundefinedの可能性がある
- `playerAttack(memberIndex, enemyIndex)`で配列の範囲チェックが不十分

**影響**: 
- アプリケーションがクラッシュする可能性
- 予期しない動作

### 2. **非nullアサーションの危険な使用**
**場所**: `app/adventure/page.tsx` (132行目)

**問題**:
- `filledParty.map(m => m!.id)`で非nullアサーションを使用しているが、`filter`の後に`map`しているため、理論的にはnullの可能性はないが、型安全性が損なわれている

**影響**:
- 型安全性の問題
- 将来的なバグの原因になる可能性

### 3. **合成機能のエラーハンドリング不足**
**場所**: `app/adventure/page.tsx` (137-199行目)

**問題**:
- `executeFusion()`関数でデータベース操作のエラーハンドリングがない
- エラーが発生した場合、ユーザーに通知されない
- 一部の操作が成功して一部が失敗した場合のロールバックがない

**影響**:
- データの整合性が損なわれる可能性
- ユーザーがエラーに気づかない

### 4. **コレクションページのエラーハンドリング不足**
**場所**: `app/adventure/collection/page.tsx`

**問題**:
- `.single()`のエラーハンドリングがない（33行目、50行目）
- エラーが発生した場合、アプリケーションがクラッシュする可能性

**影響**:
- プロフィールが存在しない場合にクラッシュ

### 5. **敵の攻撃処理でのundefinedチェック不足**
**場所**: `app/adventure/battle/page.tsx` (enemyTurn関数内)

**問題**:
- `target`がundefinedの可能性があるが、チェックされていない
- `currentAliveParty[targetIndex]`がundefinedの場合にエラーが発生する可能性

**影響**:
- バトル中のクラッシュ

## ⚠️ 中程度のバグ

### 6. **レベルアップ計算での無限ループの可能性**
**場所**: `utils/levelup.ts`

**問題**:
- `while`ループでレベルアップを処理しているが、経験値が非常に大きい場合、理論的には無限ループになる可能性がある（実際には`maxLevel`で制限されているが、防御的プログラミングとして制限を追加すべき）

**影響**:
- 非常に大きな経験値が与えられた場合のパフォーマンス問題

### 7. **HP回復処理のタイミング問題**
**場所**: `app/adventure/page.tsx` (83-102行目)

**問題**:
- HP回復処理が非同期で実行されるため、ユーザーがすぐにバトルを開始すると、HPが回復する前にバトルが始まる可能性がある

**影響**:
- ユーザーがHPが回復していない状態でバトルを開始する可能性
